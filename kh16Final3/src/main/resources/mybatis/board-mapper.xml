<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

	<select id="sequence" resultType="long">
		select board_seq.nextval from
		dual
	</select>

	<insert id="insert" parameterType="BoardDto">
		insert into board(
		board_no , title ,
		writer_no , content ,
		write_time , edit_time ,
		read_count , type
		)
		values(
		#{boardNo} , #{title} ,
		#{writerNo} , #{content} ,
		systimestamp , null ,
		0 , #{type}
		)
	</insert>

	<select id="list" resultType="BoardDto">
		select
		board_no,
		title,
		writer_no as writerNo,
		content,
		write_time as writeTime,
		edit_time as editTime,
		read_count as readCount,
		type
		from board
		order by board_no desc
	</select>

	<select id="detail" parameterType="long" resultType="BoardDto">
		select
		board_no,
		title,
		writer_no as writerNo,
		content,
		write_time as writeTime,
		edit_time as editTime,
		read_count as readCount,
		type
		from board
		where board_no = #{boardNo}
	</select>

	<select id="listByType" resultType="BoardDto"
		parameterType="string">
		select
		board_no, title, writer_no as writerNo, content,
		write_time as writeTime, edit_time as editTime,
		read_count as readCount, type
		from board
		where type = #{type} order by board_no desc
	</select>

	<delete id="delete" parameterType="long">
		delete from board where
		board_no = #{boardNo}
	</delete>

	<update id="update" parameterType="BoardDto">
		update board
		<set>
			<if test="title != null">
				title=#{title},
			</if>
			<if test="content != null">
				content=#{content},
			</if>
			edit_time=systimestamp
		</set>
		where board_no=#{boardNo}
	</update>

	<update id="updateBoardRead" parameterType="long">
		update board
		set
		read_count = read_count + 1
		where board_no = #{boardNo}
	</update>

	<select id="count" resultType="int">
		select count(*) from board
	</select>

	<select id="countQna" resultType="long" parameterType="PageVO">
		select count(*) from BOARD where TYPE = 'QNA'
		<if test="isSearch()">
			and ${column} like '%' || #{keyword} || '%'
		</if>
	</select>

	<select id="selectList" resultType="BoardDto" parameterType="PageVO">
		select *
		from (
		select rownum rn, board.*
		from BOARD board
		where TYPE = 'QNA'
		<if test="isSearch()">
			and ${column} like '%' || #{keyword} || '%'
		</if>
		order by board_no desc
		)
		where rn between #{begin} and #{end}
	</select>
	
	<select id="selectCount" resultType="int" parameterType="String">
		select count(*) from board where type = #{param1}
	</select>
	
	<select id="selectListByPaging" resultType="BoardDto" parameterType="map">
		SELECT * FROM (
			SELECT ROWNUM rn, tmp.* FROM (
				SELECT 
				    board.*,
				    member.member_nickname as writerNickname  
				FROM board
				LEFT OUTER JOIN member ON board.writer_no = member.member_no
				WHERE board.type = #{type}
				ORDER BY board.board_no DESC
			) tmp
	    ) 
	    WHERE rn BETWEEN #{begin} AND #{end}
	</select>
</mapper>