<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="comment">

    <select id="sequence" resultType="long">
		select comment_seq.nextval from dual
	</select>
	
	<insert id="insert" parameterType="CommentDto">
		insert into comments (
			comment_no, board_no, writer_no, content, status
		)
		values (
			#{commentNo}, #{boardNo}, #{writerNo}, #{content}, 'N'
		)
	</insert>
	
	<select id="list" resultType="CommentDto" parameterType="long">
		select 
            comment_no, 
            board_no as boardNo,             writer_no as writerNo,           content,                         created_time as createdTime,     edit_time as editTime,           status
		from comments
		where board_no = #{boardNo} and status = 'N'
		order by comment_no asc 
	</select>
	
	<select id="detail" resultType="CommentDto" parameterType="long">
		select 
            comment_no, 
            board_no as boardNo, 
            writer_no as writerNo, 
            content, 
            created_time as createdTime, 
            edit_time as editTime, 
            status
		from comments
		where comment_no = #{commentNo}
	</select>
	
	<update id="update" parameterType="CommentDto">
		update comments
		set content = #{content},
			edit_time = systimestamp
		where comment_no = #{commentNo}
	</update>
	
	<update id="softDelete" parameterType="long">
		update comments
		set status = 'Y'  where comment_no = #{commentNo}
	</update>
	
	<select id="findNicknameByMemberNo" parameterType="java.util.List" resultType="java.util.Map">
    	select member_no, member_nickname from member where member_no in
    <foreach item="memberNo" collection="list" open="(" separator="," close=")">
        #{memberNo}
    </foreach>
	</select>

</mapper>