<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="comment">

    <!-- 1. 댓글 시퀀스 발급 -->
	<select id="sequence" resultType="long">
		select comment_seq.nextval from dual
	</select>
	
	<!-- 2. 댓글 등록 (INSERT) -->
	<insert id="insert" parameterType="CommentDto">
		insert into comments (
			comment_no, board_no, comment_writer, comment_content, comment_status
		)
		values (
			#{commentNo}, #{commentBoardNo}, #{commentWriter}, #{commentContent}, 'y'
		)
	</insert>
	
	<!-- 3. 특정 게시글 댓글 목록 조회 -->
    <!-- DTO 필드명에 맞게 컬럼명에 AS 별칭을 사용 (comment_date -> commentTime 등) -->
	<select id="list" resultType="CommentDto" parameterType="long">
		select 
            comment_no, 
            board_no as commentBoardNo, 
            comment_writer, 
            comment_content, 
            comment_date as commentTime, 
            comment_edit_date as commentEditDate, 
            comment_status
		from comments
		where board_no = #{boardNo} and comment_status = 'y'
		order by comment_no asc 
	</select>
	
	<!-- 4. 특정 댓글 상세 조회 -->
	<select id="detail" resultType="CommentDto" parameterType="long">
		select 
            comment_no, 
            board_no as commentBoardNo, 
            comment_writer, 
            comment_content, 
            comment_date as commentTime, 
            comment_edit_date as commentEditDate, 
            comment_status
		from comments
		where comment_no = #{commentNo}
	</select>
	
	<!-- 5. 댓글 수정 (UPDATE) -->
	<update id="update" parameterType="CommentDto">
		update comments
		set comment_content = #{commentContent},
			comment_edit_date = systimestamp
		where comment_no = #{commentNo}
	</update>
	
	<!-- 6. 댓글 소프트 삭제 (softDelete) -->
	<update id="softDelete" parameterType="long">
		update comments
		set comment_status = 'n'
		where comment_no = #{commentNo}
	</update>

</mapper>